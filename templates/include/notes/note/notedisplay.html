{% load i18n %}


<script>
	jQuery(function($){
           $('#updateNoteForm').hide();     
           $('#hide_edit_note').hide();		
           $('#updateNoteTransForm').hide(); 
            $('#hide_trans').hide();
            
		$('#edit_note'). click(function(){                       
		        $('#updateNoteForm').show();
                   $('#hide_edit_note').show();
                   $('#edit_note').hide();                  
            });		
           $('#hide_edit_note'). click(function(){                       
		        $('#updateNoteForm').hide();
                   $('#hide_edit_note').hide();
                   $('#edit_note').show();
            });    

           $('#edit_trans'). click(function(){                       
		        $('#updateNoteTransForm').show();
                   $('#hide_trans').show();
                   $('#edit_trans').hide();     
                              
            });	
            $('#hide_trans'). click(function(){                       
		        $('#updateNoteTransForm').hide();
                   $('#hide_trans').hide();
                   $('#edit_trans').show();                
            });	
                
                
 
           $('span.note_tabs_item#comments'). click(function(){            
                 $('span.note_tabs_item').removeClass('present');
                  $(this).addClass("present");
                  
		         $('.add_box').hide(); 
                   $('#add_comment_box').show();
                   
                              
            });	
            
            $('span.note_tabs_item#public_comments'). click(function(){            
                $('span.note_tabs_item').removeClass('present');
                 $(this).addClass("present");             
                
                $('.add_box').hide();                
               $('#add_public_comment_box').show();
               
           
            });	
            
            $('span.note_tabs_item#courses'). click(function(){            
                    $('span.note_tabs_item').removeClass('present');
                    $(this).addClass("present");                  
                    $('.add_box').hide();      
                    $('#add_course_box').show();          
            });	
            
             $('span.note_tabs_item#outer_links'). click(function(){            
                    $('span.note_tabs_item').removeClass('present');
                    $(this).addClass("present");                  
                    $('.add_box').hide();      
                    $('#add_outer_links_box').show();          
            });	
            
            
            
            
             $('.personal_comment_submit').click(function(){ 
                        var newValue = $(this).parents("#add_comment_box").find("#add_content").val();                       
                        $.post('addComment/',{ 'id':'{{note.id}}', 'content':  newValue}, personal_commentAdded ,'json');              
    
                });
                
                $('.cancel_submit').click(function(){          
                        add_box  = $(this).parents(".add_box")
                        add_box.find("#add_content").val('');
                        add_box.hide();
      
                });
                
                
                 function personal_commentAdded(result){
                        note_id = result.note_id;
                        $('div#personal_comments').prepend('<div comment_id="'+result.comment_id+'">'+result.comment_desc+
                                                                      '<span title="{% trans "remove this comment" %}" class="inline_delete_comment" id="note_delete_comment">&nbsp;&nbsp;&nbsp;</span></div>');   
                                                                      
                         $('div#personal_comments').find("div[comment_id='"+result.comment_id+"']").find('span.inline_delete_comment').click(function(){	                
                                $(this).load('deleteComment/',{'comment_id':$(this).parents('div').attr('comment_id')});
                                $(this).parents("div[comment_id]").remove();
                        });      

                      comment_box  = $("#add_comment_box");
                      comment_box.find("#add_content").val('');
                 
                 }
                 
                 
                $('span#note_delete_comment').click(function(){	                
                    $(this).load('deleteComment/',{'comment_id':$(this).parents('div').attr('comment_id')});
                    $(this).parents("div[comment_id]").remove();
                });
                
                
                 
                  $('.public_comment_submit').click(function(){ 
                        var newValue = $(this).parents("#add_public_comment_box").find("#add_content").val();                       
                        $.post('/social/{{user.username}}/addComment/',{ 'id':'{{social_note.id}}', 'content':  newValue}, public_commentAdded ,'json');              
    
                });
                
   
                
                
                 function public_commentAdded(result){
                        note_id = result.note_id;
                        $('div#public_comments').prepend('<div comment_id="'+result.comment_id+'">'+result.comment_desc+
                                                                      '<span title="{% trans "remove this comment" %}" class="inline_delete_comment" id="note_delete_comment">&nbsp;&nbsp;&nbsp;</span></div>');   
                                                                      
                         $('div#public_comments').find("div[comment_id='"+result.comment_id+"']").find('span.inline_delete_comment').click(function(){	                
                                $(this).load('/social/{{user.username}}/deleteComment/',{'comment_id':$(this).parents('div').attr('comment_id')});
                                $(this).parents("div[comment_id]").remove();
                        });       

                        comment_box  = $("#add_public_comment_box");
                        comment_box.find("#add_content").val('');
                 
                 }
                 
                 $('span#note_delete_social_comment').click(function(){	                
                    $(this).load('/social/{{user.username}}/deleteComment/',{'comment_id':$(this).parents('div').attr('comment_id')});
                    $(this).parents("div[comment_id]").remove();
                });
            
            
            
              $('.course_submit').click(function(){ 
                        var newValue = $(this).parents("#add_course_box").find("#add_content").val();                       
                        $.post('/social/{{user.username}}/addCourse/',{ 'id':'{{note.id}}', 'url':  newValue}, courseAdded ,'json');              
    
                });
                
                
                function courseAdded(result){
                        note_id = result.note_id;
                        $('div#courses').prepend('<div course_id="'+result.course_id+'">'+result.course_url+
                                                                      '<span title="{% trans "remove this course" %}" class="inline_delete" id="note_delete_course">&nbsp;&nbsp;&nbsp;</span></div>');   
                                                                      
                         $('div#courses').find("div[course_id='"+result.course_id+"']").find('span#note_delete_course').click(function(){	                
                                $(this).load('/social/{{user.username}}/deleteCourse/',{'course_id':$(this).parents('div').attr('course_id')});
                                $(this).parents("div[course_id]").remove();
                        });       

                        course_box  = $("#add_course_box");
                        course_box.find("#add_course").val('');
                 
                 }
                 
                  $('span#note_delete_course').click(function(){	                
                        $(this).load('/social/{{user.username}}/deleteCourse/',{'course_id':$(this).parents('div').attr('course_id')});
                        $(this).parents("div[course_id]").remove();
                });
                 
                $('span#note_delete_outer_link').click(function(){	                
                        $(this).load('/social/{{user.username}}/deleteOuterlink/',{'outer_link_id':$(this).parents('div').attr('outer_link_id')});
                        $(this).parents("div[outer_link_id]").remove();
                });
                 
			
        });
</script>




{% include "include/pick_lang.html" %}         






<div>
<h2> 
<img src="/site_media/img/{{note.get_note_type}}.png" title="{{note.get_note_type}}" class="noPrint"/>
 {% include "include/get_title.html" %}   
</h2>
</div>
{% block note_type%}
{% endblock %}
<div class="grey noPrint">
{% trans 'Created' %} :<a href="{{book_uri_prefix}}/{{bookname}}/notes/?year={{note.init_date|date:"Y"}}">{{note.init_date|date:"Y"}}</a>-<a href="{{book_uri_prefix}}/{{bookname}}/notes/?year={{note.init_date|date:"Y"}}&month={{note.init_date|date:"m"}}">{{note.init_date|date:"m"}}</a>-<a href="{{book_uri_prefix}}/{{bookname}}/notes/?year={{note.init_date|date:"Y"}}&month={{note.init_date|date:"m"}}&day={{note.init_date|date:"d"}}">{{note.init_date|date:"d"}}</a>  {{note.init_date|date:"H"}}:{{note.init_date|date:"i"}}      
</div>

<br/>
 {% include "include/get_desc.html" %}     
 
{% block note_url%}
{% endblock %}

<br/>

{% block note_tags%}
<div class="noPrint">
<b><img src="/site_media/img/tags-small.png" class="img_in_notes_section_header"/>:</b> 
{% for tag in note.get_tags %}
<a href="{{book_uri_prefix}}/{{bookname}}/notes/tags/{{tag}}/">{{tag}}</a>,
{% endfor %}
</div>
{% endblock %}

<div class="noPrint">
<b>{% trans 'importance' %} : </b>{{note.vote}}
</div>
<div class="noPrint">
<b>{% trans 'private' %} :</b> {{note.private|yesno:"yeah,no,maybe" }}
</div>


{% block note_deleted%} 
{% endblock %}

{% block note_attachment%}
{% endblock %}

{% block note_in_frames%}
<div class="noPrint">
<b>{% trans 'In frames' %} : </b>
{% for frame in note.in_frames.all %}
<a href="{{book_uri_prefix}}/framebook/notes/note/{{frame.id}}/" title="{{frame.title}}">{{frame.id}}</a>,
{% empty %}
{% trans 'Not in any frame' %} .
{% endfor %}
</div>
{% endblock %}

{% block notes_in_frame%}
{% endblock %}





<br/>
{% block note_comments%}
{% comment%}
<!--li tag is added solely to accomodate the code used in the notes display page where js need to find the parent li tag to locate with note to add comment-->
{% endcomment%}
<div note_id="{{note.id}}" class="noPrint">
{% include "include/notes/inlines/add_comments_and_etc_inline.html" %}            
</div>
{% endblock %}





<br/><br/>

{% block note_form%}
 {% if user.username == profile_username %} 
<div class="noPrint">
    <span id="edit_note"><a href="#edit">{% trans 'Edit this note' %}</a></span>
    <span id="hide_edit_note"><a href="#edit">{% trans 'Hide edit form' %}</a></span>

    <form action="updateNote/" method="post" enctype="multipart/form-data" id="updateNoteForm">
        <p> {{ note_form.title.label_tag }}: {{note_form.title}}</p> 
        <p>{{ note_form.desc.label_tag }}: {{note_form.desc}}</p> 
        {% block note_form_url%}
        {% endblock %}
        <p>{{ note_form.private.label_tag }}: {{note_form.private}}</p>

        {% comment%}<!--Don't show this for now. TODO:-->
            <p>{{ note_form.deleted.label_tag }}: {{note_form.deleted}}</p> 
        {% endcomment%}

        {% block note_form_vote%}
            <p>{{ note_form.vote.label_tag }}: {{note_form.vote}}</p>
        {% endblock %}

        {% block note_form_tags%}
            <p>{{ note_form.tags.label_tag }}: {{note_form.tags}}</p>
        {% endblock %}
         
         
          {% comment%}
          init_date might not be editable in django form due to its definition in model. Might want to change this. TODO:
          <p>{{ note_form.init_date.label_tag }}: {{note_form.init_date}}</p> 
        {% endcomment%}
        

        {% block note_form_attachment%}
        {% endblock %}

        <input type="submit" value="Submit" />
    </form> 
</div>
<br/>
<div class="noPrint">
    <span id="edit_trans"><a href="#translate">{% trans 'Add or edit the translation' %}</a></span>
    <span id="hide_trans"><a href="#translate">{% trans 'Hide the translation form' %}</a></span>
    <form action="updateNoteTrans/" method="post" enctype="multipart/form-data" id="updateNoteTransForm">
        <p> {{ note_trans_form.original_lang.label_tag }}: {{note_trans_form.original_lang}}</p> 
        <p> {{ note_trans_form.lang.label_tag }}: {{note_trans_form.lang}}</p>         
        <p> {{ note_trans_form.title.label_tag }}: {{note_trans_form.title}}</p> 
        <p>{{ note_trans_form.desc.label_tag }}: {{note_trans_form.desc}}</p> 
        <input type="submit" value="Submit" />
    </form> 
</div>

{% endif %}
{% endblock %}
