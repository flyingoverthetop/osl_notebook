{% load i18n %}
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" manifest="/site_media/note_list_base.appcache"> <!--<![endif]-->
<head> 

<!--TODO:useful?-->
<meta charset="utf-8">

<title>
{% block title %}
{% endblock %}
</title>

 <link rel="stylesheet" type="text/css"  href="/site_media/css/print.css"> 

 <link rel="stylesheet" type="text/css" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/flick/jquery-ui.css">
<!--
<link href="/site_media/css/themes/flick/jquery-ui.css" rel="stylesheet" type="text/css" />-->
<link href="/site_media/css/tag-it/jquery.tagit.css" rel="stylesheet" type="text/css" />


<link rel="stylesheet" type="text/css" href="/media/css/base.css" /> 
<link rel="stylesheet" type="text/css" href="/media/css/dashboard.css" /> 

<link rel="stylesheet" type="text/css" href="/media/css/changelists.css" /> 



<!--[if lte IE 7]><link rel="stylesheet" type="text/css" href="/media/css/ie.css" /><![endif]--> 
<meta name="robots" content="NONE,NOARCHIVE" /> 

<link href="/site_media/css/editableText.css" rel="stylesheet" type="text/css" />	
<link href="/site_media/css/note.css" rel="stylesheet" type="text/css" /> 
<link rel="stylesheet" href="/site_media/css/jquery.jdMenu.css" type="text/css" /> 



	<!-- We will use jQuery hosted by Google-->
	        <!--
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>	
    
      <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.0/jquery.min.js"></script>
 
  
       <script src="/site_media/js/jquery-1.4.js" type="text/javascript"></script>	
  -->
 <!--
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js" type="text/javascript" charset="utf-8"></script>
 
-->
    <script src="/site_media/js/jquery.min.js" type="text/javascript" charset="utf-8"></script>	

  <script src="/site_media/js/jquery.hotkeys.js" type="text/javascript" charset="utf-8"></script>	

   
    <script src="/site_media/js/jquery.editableText.js" type="text/javascript"></script>
    
     <script src="/site_media/js/jquery.positionBy.js" type="text/javascript"></script>	
     <script src="/site_media/js/jquery.dimensions.js" type="text/javascript"></script>	
     
     <script src="/site_media/js/jquery.bgiframe.js" type="text/javascript"></script> 
	<script src="/site_media/js/jquery.jdMenu.js" type="text/javascript"></script> 
    

	<script src="/site_media/js/chili-1.7.pack.js"  type="text/javascript" ></script>	
	<script src="/site_media/js/jquery.easing.js"  type="text/javascript" ></script>
    <!--
	<script src="/site_media/js/jquery.accordion.js"  type="text/javascript" ></script>
    -->
    <script src="/site_media/js/jquery.AddIncSearch.js"  type="text/javascript" ></script>

	
  <!--    
    <link href="/site_media/css/tag-it/reset.css" rel="stylesheet" type="text/css" />
 
	<link href="/site_media/css/tag-it/master.css" rel="stylesheet" type="text/css" />
    -->
    
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.12/jquery-ui.min.js" type="text/javascript" charset="utf-8"></script>
 <!--
        	<script src="/site_media/js/ui/jquery-ui.min.js"  type="text/javascript" ></script>       -->
 <!--
	<link href="/site_media/css/jquery-ui/jquery.ui.autocomplete.custom.css" rel="stylesheet" type="text/css"  />
    <script src="/site_media/js/jquery-ui/jquery-ui-1.8.core-and-interactions.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="/site_media/js/jquery-ui/jquery-ui-1.8.autocomplete.min.js" type="text/javascript" charset="utf-8"></script>
       -->
	<script src="/site_media/js/tag-it.js" type="text/javascript" charset="utf-8"></script>


    
   
    
{% block extra_css %}
{% endblock %}

{% block extra_script %}
{% endblock %}

    
<script type="text/javascript">
    if ($.browser.msie) {
// window.location.replace('/changeYourBroswer/')
  }
</script>

{% include "include/notes/add_note_js.html" %}
{% include "include/notes/update_tags_inline_js.html" %}    
{% include "include/switchui_js.html" %}  
<script type="text/javascript">



	//disalbe print.css
    document.getElementsByTagName('link')[0].disabled = true;
     function print(){		
            document.getElementsByTagName('link')[0].disabled = false;
            $('#back_icon').show();
          $( "#sortable" ).sortable( "option", "disabled", true);
            };
            
      function back_from_print(){		
            document.getElementsByTagName('link')[0].disabled = true;
             $('#back_icon').hide();
            $( "#sortable" ).sortable( "option", "disabled", false);
            };      
    
    
	Array.prototype.unique = function () {
	var r = new Array();
	o:for(var i = 0, n = this.length; i < n; i++)
	{
		for(var x = 0, y = r.length; x < y; x++)
		{
			if(r[x]==this[i])
			{
				continue o;
			}
		}
		r[r.length] = this[i];
	}
	return r;
}

    function sortNumber(a,b){
            return a - b;
    }
    

     
     
    
    
    function showAddTags(){    
            //alert('show add tgs');
            $('#ac_tags_box').show(3);  
             $('#add_tags_to_notes').show(3); 
            $('#remove_tags_from_notes').hide(3);                
           //$('#ac_tags_box  li.tagit-new input').focus();   //commented out because in chrome it will cause the enterred tag shifted upwards . Not sure it is ok in showAddNoteTags
           //$('#ac_tags_box').css("background-color","#F5FC9E");//not working for now. It is probably better without it.
            
        //alert('the tags in the widgit:'+  $("#ac_tags").tagit("assignedTags"));
           
           // $('#ac_tags').css("border","groove");
                        
    }
    
    
    
    function cancelChangeTags(){    
            //alert('cancel add tgs');
            $('#ac_tags_box').hide(0);  
            //Below cannot succesfully remove tags entered earlier. I guess it is ok to leave those tags there for now
            //$('ul#ac_tags').text('')
    }
    
    function showRemoveTags(){    
            //alert('show remove tgs');
            $('#ac_tags_box').show();  
            $('#remove_tags_from_notes').show();   
            $('#add_tags_to_notes').hide();     
            $('.tagit-input').focus();     
            $('.tagit-input').css("background-color","#F5FC9E");            
    }

	
	function	addTags(){    
		    var selected_tags = [];    		    
		    $('.tag_selection').each(function(){
                    if ($(this).attr('checked')==true){			
                        selected_tags.push($(this).val());	
                    }			
		     });
             
            selected_notes = getSelectedNoteIds();		       
		    
		       
		      // $(this).load('addTags2Notes/', {'note_ids': selected_notes, 'tags_to_add': selected_tags}, processReturn);
		       
               //window.location.href=window.location.href;
		      //setTimeout( "window.location.reload(false)", 1000) ; //TODO: only load the changed notes using response from the server
		       //time out is added to fix a problem happened after uplodading to the server. If wait a while, the ajax will succeed, otherwise, will return error.
               //on local server, tags will be added or removed even return error. But on remote server, the py method is not even called.
               //On local server, no the pipe broken error any more.
               //So I think the reason is like this: this ajax call is a non-blocking one. So if you reload the page, the pipe is broken. On a local server, the ajax call is already
              //mapped to a url and method called. But for a remote server, the ajax call probably fall behind the next page reload request and is not even mapped to a url yet.         
               
               
            $.ajax({url: 'addTags2Notes/'+
                                    '?note_ids='+selected_notes+
                                    '&tags_to_add='+selected_tags,
                            success:  processReturn,
                            async:   false
            })
            
          
            
            window.location.reload(false);     
		       //return true;
		
	}
    
    function processReturn(data){
         ;    
    }
    
    
    function  addTags_new(){
    //alert('adding tags new...');
          var selected_tags = [];	
         
            $('ul#ac_tags').find('li.tagit-choice').each(function(){     
                            selected_tags.push($(this).find(':input').val());
		     });	
          //alert('selected_tags is:'+selected_tags );        
           
            selected_notes = getSelectedNoteIds();		 
           
           if (selected_notes == ""){
               alert('{% trans "Please select the notes!" %}');
               return ;
            }
              $.post('addTags2Notes2/'+
                                    '?note_ids='+selected_notes+
                                    '&tags_to_add='+selected_tags, {},
                          tagsChanged, 'json');
           
    }
	
	function removeTags(){
            var selected_tags = [];		    
		    $('.tag_selection').each(function(){
                    if ($(this).attr('checked')==true){				
                            selected_tags.push($(this).val());	
                    }			
		     });		    
		      
            selected_notes = getSelectedNoteIds();	    
		       
		       //$(this).load('removeTagsFromNotes/', {'note_ids': selected_notes, 'tags_to_add': selected_tags}, processReturn);
		       
               //window.location.href=window.location.href;
		     // setTimeout( "window.location.reload(false)", 1000);
		       //return true;
               
               
            $.ajax({url: 'removeTagsFromNotes/'+
                                    '?note_ids='+selected_notes+
                                    '&tags_to_add='+selected_tags,
                            success:  processReturn,
                            async:   false
            })
                           
            window.location.reload(false);    
	
	}
    
    
    function removeTags_new(){
          
          var selected_tags = [];	
          $('ul#ac_tags').find('li.tagit-choice').each(function(){               
                   	    //alert('find a tag:'+$(this).find(':input').val());
                            selected_tags.push($(this).find(':input').val());	
                    			
		     });	
           //alert('selected_tags is:'+selected_tags );        
           
            selected_notes = getSelectedNoteIds();		  
            if (selected_notes == ""){
               alert('{% trans "Please select the notes!" %}');
               return ;
            }
              $.post('removeTagsFromNotes2/'+
                                    '?note_ids='+selected_notes+
                                    '&tags_to_add='+selected_tags,
                            {}, tagsChanged, 'json');
            //window.location.reload(false);     
            //return false;
    
    
    
    }
    
    function tagsChanged(result){ 
//clear the tags for next input    
$("#ac_tags").tagit("removeAll");
         $('#ac_tags_box').hide();    
           //$('ul.messages').empty();//TODO:set timeout for message displayed? Like how gmail does
         $('ul.messages').append('<li class="success">{% trans "Tags are successfully updated!" %} </li>');
        for (var i=0; i < result.length; i++){
            toappend = ""        
            for (var j=0; j < (result[i][1]).length; j++){
                toappend = toappend+'<span><a href="/{{profile_username}}/{{bookname}}/notes/tags/'+result[i][1][j]+'/">'+result[i][1][j]+'</a>,</span>'
            }        
           $("li[note_id='"+result[i][0]+"']").find('div.brief_display').find('div#note_tags').empty().append(toappend);
           $("li[note_id='"+result[i][0]+"']").find('div.full_display').find('div#note_tags').find('span').empty().append(result[i][2]);
        }    
    }
		 
	
			
    function	linkNotes(){
		     selected_notes = getSelectedNoteIds();
               $('form#linkNotesForm').parents('div.linkNotes').find('div#create_frame_hint').empty();
		     $('form#linkNotesForm').parents('div.linkNotes').find('div#create_frame_hint').append("{% trans 'The following notes are going to be put into a frame:' %}"+selected_notes);
		     $('form#linkNotesForm').prepend('<input type="hidden"  name="notes"  value="'+selected_notes+'"/>');
		     $('.linkNotes').show();		
    }
		
		
    function	showSelectedPlusCachedNoteIds(){
		     notes = getSelectedPlusCachedNoteIds();
		     alert("Selected notes:"+ notes+"  You can copy and paste these ids into another form.");			
    }
		
    function	getSelectedPlusCachedNoteIds(){
		     current_selected_notes = getSelectedNoteIds();
		     cached_notes = getCachedNoteIds();
		     //alert('cached_notes:'+cached_notes);
		     notes = current_selected_notes +','+cached_notes ;
		     notes_list = notes.split(',');
		     //alert('selected_notes_list :'+selected_notes_list );		     
		     notes_set = notes_list.unique();
		     notes_set.sort(sortNumber);		     
		     //alert('selected_notes_set :'+selected_notes_set );
		     unique_notes = notes_set.toString();
		     return unique_notes;
		
    }
		
    function	showSelectedNotes(){
		      notes = getSelectedPlusCachedNoteIds();
		      $.post('toggleAddNoteMode/', {'addnote_mode':'on'});
		      return false;	
    }
		
		
    function	getCachedNoteIds(){
		       cachespan = $('#cache span');
		       cached_notes= $(cachespan).text();
		       if  (cached_notes=='no notes in cache'){
		             cached_notes ='';
		       }
		       //alert('cached_notes:'+cached_notes);
		       return cached_notes;
    }
		
    function	getSelectedNoteIds(){		    	   
		    var selected_notes = [];	
		    $('.note_selection').each(function(){
                    if ($(this).attr('checked')==true){				
                        selected_notes.push($(this).val());	
                    }			
		     });		     	
		     return selected_notes;
    }
		
    function  selectAll(){
		     $('.note_selection').attr('checked',true);
		
    }
		
    function  selectNone(){		     
		     $('.note_selection').attr('checked',false);		
    }
		
    function addNotes2Cache(cache_id){		   
            selected_notes = getSelectedNoteIds();
            //cachespan = $('span#cache_'+cache_id);		       
            $.post('/{{profile_username}}/{{bookname}}/caches/'+cache_id+'/addNotes2Cache/',{'cache_id':cache_id, 'selected_note_ids':selected_notes}, notesAdded, 'json');
    }		
		
    function notesAdded(cache){			 
            if (cache.created==true){
                    window.location.reload( false ); //for now, just refresh the page. Because the new item added to note menu cannot be clicked. (might because it is not recognized by the jd_menu plugin) TODO:
		  
                    $('div#cache').prepend('<div class="cache_item"><span id="cache_'+cache.cache_id+'">{% trans 'cache' %} ' +cache.cache_id+':' +cache.note_ids+'</span> &nbsp;&nbsp;&nbsp;<a href="/{{profile_username}}/{{bookname}}/caches/'+cache.cache_id+'/">{% trans 'View' %}</a> | <a href="javascript:clearCache('+cache.cache_id+');">{% trans 'Clear' %}</a>');		 
                    previous_cache_id = cache.cache_id-1;
                    next_cache_id = parseInt(cache.cache_id)+1;
                    //alert('<li  id="add_to_cache_'+cache.id+'"><a href="javascript:addNotes2Cache('+cache.id+');">Add selection to cache '+cache.id+'</a></li>');
                    $("li#add_to_cache_"+previous_cache_id).after('<li  id="add_to_cache_'+cache.cache_id+'"><a href="javascript:addNotes2Cache('+cache.cache_id+');">{% trans "Add selection to cache" %}'+cache.cache_id+'</a></li>' );
                    $("li#add_to_another_cache").find('a').attr('href','javascript:addNotes2Cache('+next_cache_id+');')
                    //even after adding below, it still cannot recognize the newly added li 
                 //  $('ul.jd_menu  li[id="add_to_cache_'+cache.cache_id+'"]').jdMenu(); 
// $('ul.jd_menu'). jdMenu();                  

           }
            if (cache.created==false){
                    $('span#cache_'+cache.cache_id).text("{% trans 'cache' %} " +cache.cache_id+":" +cache.note_ids);		 
            }		
            
             $('ul.jd_menu'). jdMenu();       
    }
		
    function clearCache(cache_id){	
            cachespan = $('span#cache_'+cache.cache_id);			
            div = $(cachespan).parents('div.cache_item');			
            $.post('/{{profile_username}}/{{bookname}}/caches/'+cache_id+'/'+'clearCache/', cacheCleared);			 
    }
		
		
		
    function cacheCleared(cache_id){		
            window.location.reload( false ); //for now, just refresh the page TODO:		 
            $('span#cache_'+cache_id).parents('div.cache_item').remove();		  
            $("li#add_to_cache_"+cache_id).remove();
            //TODO: if the last cache, should get rid of add to another, and restore add to the cache 1  		
    }
        
        
    function set_notes_private(){
             selected_notes = getSelectedNoteIds();
             $.post('/{{profile_username}}/{{bookname}}/setNotesPrivate/',{'note_ids':selected_notes},  set_notes_private_callback, 'json');
             //TODO: maybe no reload
            // window.location.reload( true);   
    }
    
    function  set_notes_private_callback(note_ids){                 
                    for (var i=0;i<note_ids.length;i++){
                          $("li[note_id='"+note_ids[i]+"']").find('span.lock').show();
                          $("li[note_id='"+note_ids[i]+"']").find('span.unlock').hide();          
                    }
    }
    
    
    function set_notes_public(){
             selected_notes = getSelectedNoteIds();
             $.post('/{{profile_username}}/{{bookname}}/setNotesPublic/',{'note_ids':selected_notes}, set_notes_public_callback, 'json');   
             //window.location.reload( true);               
         
    }
    
    function set_notes_public_callback(note_ids){                  
                    for (var i=0;i<note_ids.length;i++){
                          $("li[note_id='"+note_ids[i]+"']").find('span.lock').hide();
                          $("li[note_id='"+note_ids[i]+"']").find('span.unlock').show();          
                    }
    }
    
    

     
       
        
    function expandall(){       
              $('div.brief_display').hide();
              $('div.full_display').show();   
              $("div.kuoda").hide();
              $("div.yasuo").show();              
    }
        
    function collapseall(){
            $('div.brief_display').show();
            $('div.full_display').hide();
            $("div.kuoda").show();
            $("div.yasuo").hide(); 
    }
    
    
        
                    
                    
    
    
    //TODO: the ones in base2.html are not updated with the change here.
    function structure(){
              $('.structure').show();
              //$('.stream').hide();
    
            {% ifequal request.session.advanced 'on' %}                       
                    $('.advanced').show();                  
		    {% else %}                   
                    $('.advanced').hide();                   
		    {% endifequal %}     
    }
    
    function stream(){
   
          //$('.stream').show();    
          $('.structure').hide();
    }
    
    

     
    
    
    function show_confirm(){
        var r=confirm("{% trans "If you join this group, any note you make that is tagged with any of the tag of this group will be pushed to this group. Private note, however, will not be pushed, unless you specifically want to share it with a group." %}");
        if (r==true){
            window.location.replace('/groups/{{group.name}}/joinGroup')
        }
        else{
             ;
        }
    }
    
  
    //Seems not used. TODO:delete
      //~ function  addNoteTags(){
   
           //~ $('#add_note_tags_box').hide();  
    //~ }


//TODO:re-implement this in python code, since I pass the whole url in th request anyway
//below is from stackoverflow. http://stackoverflow.com/questions/901115/get-query-string-values-in-javascript
  function getParameterByName(name)
{
  name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
  var regexS = "[\\?&]" + name + "=([^&#]*)";
  var regex = new RegExp(regexS);
  var results = regex.exec(window.location.search);
  if(results == null)
    return "";
  else
    return decodeURIComponent(results[1].replace(/\+/g, " "));
}
        

	
</script>
	
<script type="text/javascript">
	$(document).ready(function(){	
    
    
        //from http://stackoverflow.com/questions/93695/best-cross-browser-method-to-capture-ctrls-with-jquery
                    //~ $(window).keypress(function(event) {
    //~ if (!(event.which == 115 && event.ctrlKey) && !(event.which == 19)) return true;
    //~ alert("Ctrl-S pressed");
    //~ event.preventDefault();
    //~ return false;
//~ });
    
	
     //TODO:make it work when the textarea is still focused (without having to leave the textarea input box first)
      $("*").bind('keydown', 'alt+s', addNote);
      //$('div.addnote #id_desc').bind('keydown', 'alt+s', addNote);
      
       $("*").bind('keydown', 'alt+p', showDisplayMode);
       
       
       
       function showDisplayMode(){
            $("#display_mode").toggle();     
       
       }
       
           $(window).bind('keydown', 'alt+m', structure);
    
     $(window).bind('keydown', 'alt+l', stream);
     
    

     $("*").bind('keydown', 'alt+h', hideRightSideMenu);
        
         function hideRightSideMenu(){       
              $(".hide_side_menu").trigger('click');       
       }
    
     $("*").bind('keydown', 'alt+r', showRightSideMenu);
        
         function showRightSideMenu(){  
              $(".show_side_menu").trigger('click');       
       }
       
    
    
        
             $('.share_button').click(function(){	
                //selected_notes = getSelectedNoteIds();
                //$.post('/{{profile_username}}/{{bookname}}/share/',{'note_ids':selected_notes}, shared, 'json');
                pick_lang = getParameterByName('pick_lang')
                $.post('/social/{{bookname}}/share/',{'note_ids':$(this).parents('div').attr('note_id'), 'url':document.URL, 'pick_lang':pick_lang}, shared, 'json');
     
           });
           
            function shared(result){      
                if (result.count_of_sites==0){
                        alert('{% trans "You have not set up sites for sharing. Please set it up in the settings." %}');
                }
                else{           
                        alert(result.count_of_notes+'{% trans " notes are shared with" %} '+ result.count_of_sites+' {% trans "sites! You can change sites for sharing in the settings." %} ');
                }
		
      }

    

          $('li.note_display').mouseenter(function(){	    
                        $(this).find('.hover').show();
                        
                });
                
           $('li.note_display').mouseleave(function(){	    
                        $(this).find('.hover').hide();

                        
                });     
    
    
            $('#ac_tags_box').hide();
           
           $('.jd_menu').hide();
           
            $('.note_selection').click(function(){	
                 $('.jd_menu').hide();
                 $('div.linkNotes').hide();
                  $('.note_selection').each(function(){
                    if ($(this).attr('checked')==true){			
                       $('.jd_menu').show();
                    }			
		     });
           
            });
              
            $('#select_notes').click(function(){	               
                    if ($(this).attr('checked')==true){			
                       $('.jd_menu').show();
                    }else{
                       $('.jd_menu').hide();
                       $('div.linkNotes').hide();
                    }     
           
            }); 
            
            
              
    
            $('.stream').show();    
            $('.structure').hide();
            
            $('.show_tags_section').show();
            $('.hide_tags_section').hide();
            $('.tag_menu_box').hide();
            
            $('.show_side_menu').hide();
            $('.hide_side_menu').click(function(){	  
                        
                $('.show_side_menu').show();
                $('.hide_side_menu').hide();
                $('#content-related').hide();
                if (screen.availWidth > 1300){           
                    $('#main').css({'width':'1120px'});
                    $('.note_table td.note_table_td1').css({'width': '14em'});
                    $('.note_table td.note_table_td2').css({'width': '30em'});
                    $('.note_table td.note_table_tags').css({'width': '50em'});
                    $('.snippetbook .brief_display #note_desc').css({'width': '63em'});
                    $('.bookmarkbook .brief_display #note_title').css({'width': '33em'});
                    $('.bookmarkbook .brief_display #note_url').css({'width': '30em'});
                    $('.scrapbook .brief_display #note_url').css({'width': '14em'});
                    $('.scrapbook .brief_display #note_desc').css({'width': '50em'});
                }else{
                    $('#main').css({'width':'970px'});
                    $('.note_table td.note_table_td1').css({'width': '12em'});
                    $('.note_table td.note_table_td2').css({'width': '27em'});
                    $('.note_table td.note_table_tags').css({'width': '40em'});
                    $('.snippetbook .brief_display #note_desc').css({'width': '45em'});
                    $('.bookmarkbook .brief_display #note_title').css({'width': '28em'});
                    $('.bookmarkbook .brief_display #note_url').css({'width': '27em'});
                    $('.scrapbook .brief_display #note_url').css({'width': '14em'});
                    $('.scrapbook .brief_display #note_desc').css({'width': '43em'});
              
              }
                         
                });
                
            $('.show_side_menu').click(function(){	               
                    $('.show_side_menu').hide();
                    $('.hide_side_menu').show();
                    $('#content-related').show();
                    if (screen.availWidth > 1300){           
                        $('#main').css({'width':'897px'});
                        $('.note_table td.note_table_td1').css({'width': '14em'});
                        $('.note_table td.note_table_td2').css({'width': '25em'});
                        $('.note_table td.note_table_tags').css({'width': '40em'});
                        $('.snippetbook .brief_display #note_desc').css({'width': '50em'});
                        $('.bookmarkbook .brief_display #note_title').css({'width': '22em'});
                        $('.bookmarkbook .brief_display #note_url').css({'width': '25em'});
                        $('.scrapbook .brief_display #note_url').css({'width': '15em'});
                        $('.scrapbook .brief_display #note_desc').css({'width': '35em'});
                    }else{
                        $('#main').css({'width':'745px'});
                        $('.note_table td.note_table_td1').css({'width': '14em'});
                        $('.note_table td.note_table_td2').css({'width': '23em'});
                        $('.note_table td.note_table_tags').css({'width': '30em'});
                        $('.snippetbook .brief_display #note_desc').css({'width': '35em'});
                        $('.bookmarkbook .brief_display #note_title').css({'width': '18em'});
                        $('.bookmarkbook .brief_display #note_url').css({'width': '22em'});
                        $('.scrapbook .brief_display #note_url').css({'width': '14em'});
                        $('.scrapbook .brief_display #note_desc').css({'width': '26em'});
              
              }
                          
                          
                });
             
            $('.hide_tags_section').click(function(){	  
                        
                        $('.show_tags_section').show();
                        $('.hide_tags_section').hide();
                         $('.tag_menu_box').hide();
                });
                
            $('.show_tags_section').click(function(){	    
                        $('.show_tags_section').hide();
                        $('.hide_tags_section').show();
                         $('.tag_menu_box').show();
                });
    

	
            $('#id_folder_name').hide();
            $('#submit_saveSearch').hide();
            $('#show_folder_name_input').click(function(){
                    $('#id_folder_name').show();
                    $('#submit_saveSearch').show();
                    $(this).hide();
            });
            
            {% ifequal request.session.advanced 'on' %}                       
                    $('.advanced').show();
                    $('.stream').show();    
                    $('.structure').hide();
		    {% else %}                   
                    $('.advanced').hide();                   
		    {% endifequal %}
	
	
            {% ifequal addnote_mode 'on' %}	             
                    $('.show_add_note_section').hide();
                    $('.hide_add_note_section').show();
                    $('.addnote').show();				
		    {% else %}
                    $('.show_add_note_section').show();
                    $('.hide_add_note_section').hide();
                    $('.addnote').hide();
		    {% endifequal %}
		     //$('.hide_add_note_section').hide();
		    $('.show_add_note_section').click(function(){
                    $('.addnote').show();
                    $(this).hide();
                    $('.hide_add_note_section').show();
                    $.post('toggleAddNoteMode/', {'addnote_mode':'on'});
                    return false;
            });
		
            $('.hide_add_note_section').click(function(){
                    $('.addnote').hide();
                    $(this).hide();
                    $('.show_add_note_section').show();
                    $.post('toggleAddNoteMode/', {'addnote_mode':'off'});
                    return false;
            });
		
            {% ifequal show_notes_mode 'on' %}	             
                    $('.show_notes_section').hide();
                    $('.hide_notes_section').show();
                    $('div#notes_section').show();				
            {% else %}
                    $('.show_notes_section').show();
                    $('.hide_notes_section').hide();
                    $('div#notes_section').hide();
		    {% endifequal %}
		
		
            $('.hide_notes_section').click(function(){
                    $('div#notes_section').hide();
             		$(this).hide();   
                    $('.show_notes_section').show();
                    $.post('toggleShowNotesMode/', {'show_notes_mode':'off'});
                    return false;
            });
		
            $('.show_notes_section').click(function(){
                    $('div#notes_section').show();	
                    $(this).hide();   	
                    $('.hide_notes_section').show();
                    $.post('toggleShowNotesMode/', {'show_notes_mode':'on'});
                    return false;
            });
		
		
		    {% ifequal show_caches_mode 'on' %}	             
                    $('.show_caches_section').hide();
                    $('.hide_caches_section').show();
                    $('div#caches_section').show();				
		    {% else %}
                    $('.show_caches_section').show();
                    $('.hide_caches_section').hide();
                    $('div#caches_section').hide();
		    {% endifequal %}
		
		
            $('.hide_caches_section').click(function(){
                    $('div#caches_section').hide();
             		$(this).hide();   
                    $('.show_caches_section').show();
                    $.post('toggleShowCachesMode/', {'show_caches_mode':'off'});
                    return false;
            });
		
            $('.show_caches_section').click(function(){
                    $('div#caches_section').show();	
                    $(this).hide();   	
                    $('.hide_caches_section').show();
                    $.post('toggleShowCachesMode/', {'show_caches_mode':'on'});
                    return false;
            });
		
		     
		        
           // $('#addnoteSubmit').click(function(){		   
            //        var form = $(this).parents('form');			
            //        $(this).load('addNote/',{'title':form.find('#id_title').val(),'desc':form.find('#id_desc').val(),'event':form.find('#id_event').val(), 
		//	                                       'vote':form.find('#id_vote').val(),'tags':form.find('#id_tags').val(),'private':form.find('#id_private').val(), 'attachment':form.find('#id_attachment').val()}); //TODO: broken pipe issue on the server side
		
          //          return false; //need this to prevent flashing the page again, e.g. requesting the same page again, which is nice in my case (although causing broken pipe -- seems avoidable if  server don't return response), but it is still refreshs the page
         //   });	

		
		
            //TODO: where to define the call back
      //      function addNoteCallback(n){
	                //alert("note added");     
      //      }			
	     
	   	
            $('div.brief_display').show();
            $('div.full_display').hide();		
		
		
            $('.yasuo').hide();
		
            $('.kuoda').click(function(){		
                    $(this).parents("li").find('div.brief_display').hide(100);
                    $(this).parents("li").find('div.full_display').show(100);
                
                    $(this).parents("li").find("div.kuoda").hide(100);
                    $(this).parents("li").find("div.yasuo").show(100);		
            });
		
            $('.yasuo').click(function(){        
                    $(this).parents("li").find('div.brief_display').show(100);
                    $(this).parents("li").find('div.full_display').hide(100);		       
                    $(this).parents("li").find("div.kuoda").show(100);
                    $(this).parents("li").find("div.yasuo").hide(100);		
            });		

        
		
            $("a:contains('(No Title)')").css({'font-weight':100,'font-size':9});	
            $("a:contains('（无标题）')").css({'font-weight':100,'font-size':9});	
            $("li.note_display:odd").css("background-color", "#FFFFFF");
            //$("li.note_display:even").css("background-color", "#E0FFFF");
            $("li.note_display:even").css("background-color", "#F5FFD6");
            //$("li.note_display:even").css("background-color", "#9DB25D");
		
        tagsAvailable = [{% for tag in tags %}"{{tag}}",{% endfor %}];

		    $("#ac_tags").tagit({
			    availableTags: tagsAvailable,
                   allowSpaces: true
            });    


            $(":input[name='sort']").change(function(){                      
                window.location.replace('?sort='+$(this).val())      
                 insertParam('sort', $(this).val());
             });
             
         
              $(":input[name='select_notes']").change(function(){                      
                   $(this).is(':checked') ? selectAll() :  selectNone();
             });
             
             
             //handle comments and etc
             
                             
               $('span#personal_comments').click(function(){                   
                        parent = toggleBox($(this));          
                        parent.find('#add_personal_comment_box').show();      
                });
                
                
                $('span#public_comments').click(function(){                   
                        parent = toggleBox($(this));                                                
                        parent.find('#add_public_comment_box').show();      
                });
                
               $('span#comments_on_included').click(function(){                   
                        parent = toggleBox($(this));                                                
                        parent.find('#add_comments_included_box').show();      
                });
                
                
            $('span#courses'). click(function(){            
                     parent = toggleBox($(this));                
                     parent.find('#add_course_box').show();          
            });	
            
             $('span#inner_links'). click(function(){            
                        parent = toggleBox($(this));             
                        parent.find('#add_inner_links_box').show();          
            });	            
            
             $('span#outer_links'). click(function(){            
                     parent = toggleBox($(this));             
                     parent.find('#add_outer_links_box').show();          
            });	
            
             function toggleBox(clickedEle){
                        parent = clickedEle.parents('div[note_id]');   
                        parent.find('span.note_tabs_item').removeClass('present');
                        clickedEle.addClass("present");        
                        parent.find('.add_box').hide();   
                        return parent;
                }
                
                
             
                    $('.cancel_submit').click(function(){          
                        add_box  = $(this).parents(".add_box")
                        add_box.find("#add_content").val('');
                        add_box.hide();
      
                });
             
             
             
                    $('.personal_comment_submit').click(function(){ 
                        var newValue = $(this).parents("#add_personal_comment_box").find("#add_content").val();
                        $.post('addComment/',{ 'id':$(this).parents('div[note_id]').attr('note_id'), 'content':  newValue}, personal_commentAdded ,'json');              
      
                });
                
         
               
                
                function personal_commentAdded(result){
                     note_id = result.note_id;
                     $("div[note_id='"+note_id+"']").find('div#personal_comments').prepend('<div comment_id="'+result.comment_id+'">'{% block comment_display  %}+result.comment_desc+
                                                                      {% endblock %}'<span title="{% trans "remove this comment" %}" class="inline_delete" id="note_delete_personal_comment">&nbsp;&nbsp;&nbsp;</span></div>');   
                   
                    $("div[note_id='"+note_id+"']").find('div#personal_comments').find("div[comment_id='"+result.comment_id+"']").find('span.inline_delete').click(function(){	                
                        $(this).load('deleteComment/',{'comment_id':$(this).parents('div').attr('comment_id')});
                        $(this).parents("div[comment_id]").remove();
                   });
                
                    comment_box = $("div[note_id='"+note_id+"']").find('div#add_personal_comment_box');
                    comment_box.find("#add_content").val('');            
                
                }
                
             
                
                $('span#note_delete_personal_comment').click(function(){	                
                    $(this).load('deleteComment/',{'comment_id':$(this).parents('div').attr('comment_id')});
                    $(this).parents("div[comment_id]").remove();
                });
                

                
                
                   $('.public_comment_submit').click(function(){  
                       {% if user.is_anonymous %}
                                alert('{% trans "You are not logged in! Please login first." %}');
                        {% else %} 
                                var newValue = $(this).parents("#add_public_comment_box").find("#add_content").val();                       
                                $.post('/social/{{user.username}}/addComment/',{ 'id':$(this).parents('div[note_id]').attr('social_note_id'), 'content':  newValue}, public_commentAdded ,'json');  
                        
                       {% endif %} 
                });
                
              
                
                  function public_commentAdded(result){
                        note_id = result.note_id;               
                        $('div[social_note_id="'+note_id+'"]').find('div#public_comments').prepend('<div comment_id="'+result.comment_id+'">'+result.comment_desc+
                                                                      '<span title="{% trans "remove this comment" %}" class="inline_delete" id="note_delete_public_comment">&nbsp;&nbsp;&nbsp;</span></div>');   
                                                                      
                         $('div#public_comments').find("div[comment_id='"+result.comment_id+"']").find('span.inline_delete').click(function(){	                
                                $(this).load('/social/{{user.username}}/deleteComment/',{'comment_id':$(this).parents('div').attr('comment_id')});
                                $(this).parents("div[comment_id]").remove();
                        });       

                        comment_box  = $ ("div[social_note_id='"+note_id+"']").find("#add_public_comment_box");
                        comment_box.find("#add_content").val('');
                 
                 }
                                
                
                 $('span#note_delete_public_comment').click(function(){	                
                    $(this).load('/social/{{user.username}}/deleteComment/',{'comment_id':$(this).parents('div').attr('comment_id')});
                    $(this).parents("div[comment_id]").remove();
                });
                            
                
                $('.course_submit').click(function(){ 
                        var newValue = $(this).parents("#add_course_box").find("#add_content").val();                       
                        $.post('/social/{{user.username}}/addCourse/',{ 'id':$(this).parents('div[note_id]').attr('social_note_id'), 'url':  newValue}, courseAdded ,'json');              
    
                });
                
                
                function courseAdded(result){
                        note_id = result.note_id;
                        $('div#courses').prepend('<div course_id="'+result.course_id+'">'+result.course_url+
                                                                      '<span title="{% trans "remove this course" %}" class="inline_delete" id="note_delete_course">&nbsp;&nbsp;&nbsp;</span></div>');   
                                                                      
                         $('div#courses').find("div[course_id='"+result.course_id+"']").find('span.inline_delete').click(function(){	                
                                $(this).load('/social/{{user.username}}/deleteCourse/',{'course_id':$(this).parents('div').attr('course_id')});
                                $(this).parents("div[course_id]").remove();
                        });       

                        course_box  = $("#add_course_box");
                        course_box.find("#add_content").val('');                 
                 }
                 
                  $('span#note_delete_course').click(function(){	                
                        $(this).load('/social/{{user.username}}/deleteCourse/',{'course_id':$(this).parents('div').attr('course_id')});
                        $(this).parents("div[course_id]").remove();
                });
                 
                $('span#note_delete_outer_link').click(function(){	                
                        $(this).load('/social/{{user.username}}/deleteOuterlink/',{'outer_link_id':$(this).parents('div').attr('outer_link_id')});
                        $(this).parents("div[outer_link_id]").remove();
                });
               
                
                
                
                $('span.unlock').click(function(){	                   
                    $.post('makePrivate/',{'id':$(this).parents('li').attr('note_id')}, privacyChanged, 'json');                   
                });
                
                 $('span.lock').click(function(){	                   
                    $.post('makePublic/',{'id':$(this).parents('li').attr('note_id')}, privacyChanged, 'json');                   
                });
               
               
                 function privacyChanged(result){                 
                    note_id = result.note_id
                    if (result.private == 'y'){
                    //alert('is true');                          
                          $("li[note_id='"+note_id+"']").find('span.lock').show();
                          $("li[note_id='"+note_id+"']").find('span.unlock').hide();
                    }else{
                   //alert('is fale');
                          $("li[note_id='"+note_id+"']").find('span.unlock').show();
                          $("li[note_id='"+note_id+"']").find('span.lock').hide();
                    }
                     
                
                }
              
                
                
              //below is just a testing  
          //      $("input.tagit-input").keydown(function(){
  //  $(this).css("background-color","#FFFFCC");
  //});
 // $("input.tagit-input").keyup(function(){
  //  $(this).css("background-color","#D6D6FF");
 // });
                
                
               
         //firefox and chrome have different interpretation of screen.availWidth (For FF, with zooming, the screen size changes, while for chrome it doesn't.)  
        if (screen.availWidth > 1100){      
              $('#container').css({'width':'1150px'});
              $('.note_table td.note_table_td1').css({'width': '14em'});
              $('.note_table td.note_table_td2').css({'width': '25em'});
              $('.note_table td.note_table_tags').css({'width': '40em'});
              $('.snippetbook .brief_display #note_desc').css({'width': '50em'});
              $('.bookmarkbook .brief_display #note_title').css({'width': '22em'});
              $('.bookmarkbook .brief_display #note_url').css({'width': '25em'});
              $('.scrapbook .brief_display #note_url').css({'width': '15em'});
              $('.scrapbook .brief_display #note_desc').css({'width': '35em'});
        }
                

                                    
    
        
        
        
        
             $("span.included_notes_edit"). click(function(){             
                        var  editable =    $(this).parents('span.editable') ; 
                        editable.prepend('<span class="included_notes_save">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="included_notes_cancel">&nbsp;&nbsp;&nbsp;&nbsp;</span>');                        
                        editable.find("#update_included_notes_inline_box").show();
                        $(this).hide();
                           
                           
                         $("span.included_notes_cancel"). click(function(){     
                                var  editable =    $(this).parents('span.editable') ;                      
                                editable.find("#update_included_notes_inline_box").hide();                    
                                editable.find('span.included_notes_save').remove();
                                editable.find('span.included_notes_edit').show();                                
                                $(this).remove();                                
                         }); 
                       
                         
                         $("span.included_notes_save"). click(function(){           
                                 var included_notes_added = $(this).parents('span.editable').find(':input').val();	
                                 var  editable =    $(this).parents('span.editable') ;          
                                  note_id = $(this).parents('div[note_id]').attr('note_id');
                                  notes_to_add_list = included_notes_added.split(" ,");                             
                                  for (var i=0;i<notes_to_add_list.length;i++){
                                        if (notes_to_add_list[i] == note_id){
                                            alert('{% trans "You cannot add a note to itself!"%}');
                                            return false;
                                        }    
                                  //prevent adding existing included notes as well. #TODO:  
                                    }
                                   if (editable.hasClass('create')){
                                        $.post('createNoteInFrame/',{ 'id':note_id, 'note_created_desc' :  included_notes_added}, included_notes_updated_inline ,'json');      
                                   }else{
                                        $.post('addNotesToFrame/',{ 'id':note_id, 'included_notes_added':  included_notes_added}, included_notes_updated_inline ,'json');      
                                  }                                    
           
                            });            

                           
                            function included_notes_updated_inline(result){           
                                        //var  editable =     $('li[note_id="'+result.note_id+'"] div.full_display  div#note_add_notes span.editable') ;     
                                 
                                      
                                        var  editable =     $('div[note_id="'+result.result.note_id+'"]  div#note_add_notes span.editable') ; 
                                        msg_span = editable.find('span.msg');
                                        msg_span.empty();
                                        msg_span.hide();
                                          if (result.type == 'error'){
                                               msg_span.append(result.msg);
                                               msg_span.show();
                                        }else{

                                       //below applies to both frames display and a single frame display page
                                        editable.find('span.included_notes_cancel').remove();
                                        //TODO:define variable with jquery
                                        editable.find("#update_included_notes_inline_box").hide();                    
                                        editable.find('span.included_notes_save').remove();
                                        editable.find('span.included_notes_edit').show();                               
                                      
                                        
                                        //for frames display
                                        var full_display = editable.parents('div.full_display');
                                        var ul_full = full_display.find('div div#note_notes ul');                                  
                                         
                                        var ul_brief  = full_display.parents('div.framebook').find('div.brief_display').find('div#note_notes ul');
                                         //alert('ul_brief is:'+ul_brief.html());     
                                         
                                        result = result.result; 
                                        for (var i=0;i<result.notes_added.length;i++){ 
                                        
                                         
                                           
                                            if (result.notes_added[i][1] == ''){
                                                title = '{% trans "(No Title)" %}';
                                            }else{
                                                title  = result.notes_added[i][1];
                                            }
                                         
                                          
                                           //for frame display
                                          var frame_tree = $('ul.frame_tree');                                    
                                          frame_tree.find('li:last').removeClass('last');                                        
                                          frame_tree.append('<li class="note_in_frame last"  note_id="'+result.notes_added[i][0]+'"  linked_note_id="'+result.notes_added[i][0]+'"><img src="/site_media/img/'+result.notes_added[i][5]+'.png" title="'+result.notes_added[i][5]+'"/><a href="/{{profile_username}}/'+result.notes_added[i][4]+'/notes/note/'+result.notes_added[i][0]+'"><strong>'+title+'</strong></a>'+
                                                                                '&nbsp;&nbsp;&nbsp;'+result.notes_added[i][2]+'&nbsp;&nbsp;&nbsp;&nbsp;'+result.notes_added[i][3]+' &nbsp;&nbsp;&nbsp;&nbsp;'+
                                                                                '<span title="remove this note from the frame" class="inline_delete" id="frame_delete_note">&nbsp;&nbsp;&nbsp;</span></li>');
                                        
                                        
                                          frame_tree.find('li[note_id="'+result.notes_added[i][0]+'"] span#frame_delete_note').click(function(){	
                                             //alert('linked_note_id:'+linked_note_id);
                                                    $.post('deleteNoteFromFrame/',{ 'linkage_id':$(this).parents('div[note_id]').attr('note_id'), 'note_id':$(this).parents('li[linked_note_id]').attr('linked_note_id')});                                        
                                                    $(this).parents("li[linked_note_id]").remove();                                                   
                                            });                                      
                                        
                                          
                                             //for frames display
                                            var toappend = '<div linked_note_id="'+result.notes_added[i][0]+'">'+
                                                                           '<li><img src="/site_media/img/'+result.notes_added[i][5]+'.png" title="'+result.notes_added[i][5]+'"/><a href="/{{profile_username}}/'+result.notes_added[i][4]+'/notes/note/'+result.notes_added[i][0]+'"><strong>'+title+'</strong></a>'+
                                                                                '&nbsp;&nbsp;&nbsp;'+result.notes_added[i][2]+'&nbsp;&nbsp;&nbsp;&nbsp;'+result.notes_added[i][3]+' &nbsp;&nbsp;&nbsp;&nbsp;'+
                                                                                '<span title="remove this note from the frame" class="inline_delete" id="frame_delete_note">&nbsp;&nbsp;&nbsp;</span>'+
                                                                            '</li>'+           
                                                                    '</div>';
                                             ul_full.append(toappend);
                                             ul_brief.append(toappend);
                                             
                                             //add event to the newly added included note
                                            //has to get the num out instead of using result.notes_added[i][0] directly in the event function. TODO: why?
                                             linked_note_id = result.notes_added[i][0]
                                            $('li[note_id="'+result.note_id+'"] div.full_display  div[linked_note_id="'+linked_note_id+'"]  span#frame_delete_note').click(function(){	
                                             //alert('linked_note_id:'+linked_note_id);
                                                    $.post('deleteNoteFromFrame/',{ 'linkage_id':$(this).parents('li.note_display').attr('note_id'), 'note_id':$(this).parents('div[linked_note_id]').attr('linked_note_id')});
                                                    //need to remove the one in brief_display as well
                                                    $(this).parents('div.framebook').find('div.brief_display').find('div#note_notes ul').find("div[linked_note_id='"+linked_note_id+"']").remove();                                              
                                                    $(this).parents("div[linked_note_id]").remove();                                                   
                                            });
                                            
                                             $('li[note_id="'+result.note_id+'"] div.brief_display  div[linked_note_id="'+linked_note_id+'"]  span#frame_delete_note').click(function(){	
                                                    $.post('deleteNoteFromFrame/',{ 'linkage_id':$(this).parents('li.note_display').attr('note_id'), 'note_id':$(this).parents('div[linked_note_id]').attr('linked_note_id')});                                                   
                                                     //need to remove the one in brief_display as well
                                                    $(this).parents('div.framebook').find('div.full_display').find('div#note_notes ul').find('div[linked_note_id="'+linked_note_id+'"]').remove();
                                                    $(this).parents("div[linked_note_id]").remove();                                                   
                                            });
                                           
                          
                                         } 
                                    }
                            }        
            
                            // alert('after callback');     
            
                    });          
             
             
        
        
           $('span#hide_attachment').hide();	
           $('span#show_attachment'). click(function(){          
		        $('.attachment').show();
                   $('span#hide_attachment').show();
                   $('span#show_attachment').hide();                  
            });		
           $('#hide_attachment'). click(function(){            
		        $('.attachment').hide();
                   $('span#hide_attachment').hide();
                   $('span#show_attachment').show();
            });  
            
            
            
            
       //from http://stackoverflow.com/questions/486896/adding-a-parameter-to-the-url-with-javascript 
      //Using escape() to escape URL parameters is wrong. It breaks for values with "+" in them. You should be using encodeURIComponent instead. Full discussion: xkr.us/articles/javascript/encode-compare - Darwin    
//If there is no parameters at all, it add an & right after ? . It does't look good, but it works. TODO:      
function insertParam(key, value)
{
    key = escape(key); value = escape(value);

    var kvp = document.location.search.substr(1).split('&');    

    var i=kvp.length; var x; while(i--) 
    {
        x = kvp[i].split('=');

        if (x[0]==key)
        {
                x[1] = value;
                kvp[i] = x.join('=');
                break;
        }
    }

    if(i<0) {kvp[kvp.length] = [key,value].join('=');}
  //alert('kvp:'+kvp);
    //this will reload the page, it's likely better to store this until finished
    document.location.search = kvp.join('&'); 
   // alert('search:'+kvp.join('&'));
}



            
            //pick a language drop down  select with class lang_drop_down 
            $(":input[name='pick_lang']").change(function(){       
                //window.location.replace('?pick_lang='+$(this).val())
                insertParam('pick_lang', $(this).val());
             });
              //pick empty frames drop down  select with class frame_empty_drop_down 
             $(":input[name='pick_empty']").change(function(){       
                //window.location.replace('?pick_empty='+$(this).val())
                insertParam('pick_empty', $(this).val());
             });
             
              //pick learning plans frames drop down  select with class frame_plan_drop_down 
             $(":input[name='pick_plan']").change(function(){       
                      insertParam('pick_plan', $(this).val());
             });
           
                $(":input[name='pick_top']").change(function(){      
                       insertParam('pick_top', $(this).val());
             });
           
                
                
                            //move below to a separate file
                $('.thumbup'). click(function(){                
                        $(this).parents(".thumb").find("#note_rank").load('voteUpNote/',{ 'id':$(this).parents("div").attr('note_id')});
                });
		
                $('.thumbdown'). click(function(){
                        $(this).parents(".thumb").find("#note_rank").load('voteDownNote/',{ 'id':$(this).parents("div").attr('note_id')});
                });
		
        
        
         $(":input#bookname_drop_down").change(function(){        
                 current_select = $(this).val();
                if (current_select == 'Snippets')
                        bookname = "snippetbook";
                  if (current_select == 'Bookmarks')
                        bookname = "bookmarkbook";      
                  if (current_select == 'Scraps')
                        bookname = "scrapbook";  
                  if (current_select == 'Frames')
                        bookname = "framebook";  
                  if (current_select == 'All')
                        bookname = "notebook";    
                  window.location.replace('{{book_uri_prefix}}/'+bookname+'/notes/')  ;    
                        
         
                });
                
                //delete note on note display page
                $('#soft_delete'). click(function(){
                        $(this).load('deleteNote/',{ 'id':$(this).parents("div").attr('note_id')}, note_deleted, 'text');
                       
                });
                
                function note_deleted(result){
                     if (result=='True')
                           window.location.reload(true); 
                
                }
                
                 $('#hard_delete'). click(function(){  
                      var r=confirm("{% trans 'Are you sure you want to discard this? This note will be deleted permanently and it cannot be recovered!' %}");
                      if (r==false){    
                      }else{
                     
                         $(this).load('discardNote/',{ 'id':$(this).parents("div").attr('note_id')}, note_discarded, 'text');
                         
                        
                      }
                });
                
                 function note_discarded(result){
                     if (result=='True')
                           window.location.replace('{{book_uri_prefix}}/{{bookname}}/notes/') ;
                
                }
                
                 $('#restore'). click(function(){                      
                     
                         $(this).load('restoreNote/',{ 'id':$(this).parents("div").attr('note_id')}, note_restored, 'text');
                });
                
                 function note_restored(result){
                     if (result=='True')
                            window.location.reload(true); 
                
                }
        
     

         
        
        {% block extra_ready_script %}
        {% endblock %}

        

                
                
                
    
    });
    
    
	
/*	
jQuery().ready(function(){
//below not used

jQuery('.note_display').accordion({ 
   
    header: 'div.accordion_title',
 
    active: false, 
    alwaysOpen: false, 
    animated: false, 
    autoheight: false 
});
});
*/
    


	
</script>
	
	


</head>  
<body> 
  <!--[if lt IE 9]>
            <p class="chromeframe">{% trans "You are using an outdated browser." %} <a href="http://browsehappy.com/">{% trans "Upgrade your browser today" %}</a>{% trans " or " %}<a href="http://www.google.com/chromeframe/?redirect=true">{% trans "install Google Chrome Frame" %}</a>{% trans " to better experience this site." %}</p>
        <![endif]-->

{% include "include/sites_header.html" %}


<div id="container">



{% include "include/notice_alert.html" %}






{% block site_apps_menu %}
{% endblock %}


{% block help_message_if_none %}
{% endblock %}



{% include "include/message.html" %}








 <div  id="content" class="colMS"> 
 
 <span id="toggle_side_menu" class="noPrint">
<span class="show_side_menu"><img title="{% trans "show side menu" %}" src="/site_media/img/left-arrow.jpg" class="clickable"/></span>
<span class="hide_side_menu"><img title="{% trans "hide side menu" %}" src="/site_media/img/down-arrow.jpg" class="clickable"/></span> 
</span>

<div id="content-related" class="noPrint"> 


<div id="display_mode"  style="display:none">

{% if user.username == profile_username %}


        <h4>{% trans "Delete" %}</h4>     
        {% if delete  in true_words  %}
             <span style="font-size:15px">{% trans "Yes" %}</span><br/>
        {% else %}
            <a href="?delete=True">{% trans "Yes" %}</a><br/>        
        {% endif %}    

        {% if delete in false_words %}
             <span style="font-size:15px">{% trans "No" %}</span><br/>
        {% else %}
             <a href="?delete=False">{% trans "No" %}</a><br/>        
        {% endif %}
       
           

        <h4>{% trans "Private" %}</h4>  
        {% if private in all_words %}
             <span style="font-size:15px">{% trans "All" %}</span><br/>
        {% else %}
            <a href="?private=All">{% trans "All" %}</a><br/>         
        {% endif %}
        
        {% if private  in true_words  %}
             <span style="font-size:15px">{% trans "Yes" %}</span><br/>
        {% else %}
            <a href="?private=True">{% trans "Yes" %}</a><br/>         
        {% endif %}
        
        {% if private in false_words%}
             <span style="font-size:15px">{% trans "No" %}</span><br/>
        {% else %}
            <a href="?private=False">{% trans "No" %}</a><br/>              
        {% endif %} 
       
       
{% endif %}


       <h4>{% trans "Date Range" %}</h4>   

    
 
{% if date_range  in all_words %}
 <span style="font-size:15px">{% trans "Any day" %}</span><br/>
 {% else %}
<a href="?date_range=All">{% trans "Any day" %}</a><br/>   
{% endif %}

 {% if date_range == 'today' %}
 <span style="font-size:15px">{% trans "Today" %}</span><br/>
 {% else %}
<a href="?date_range=today">{% trans "Today" %}</a><br/> 	
{% endif %}

{% if date_range == 'past7days' %}
 <span style="font-size:15px">{% trans "Past 7 Days" %}</span><br/>
 {% else %}
<a href="?date_range=past7days">{% trans "Past 7 Days" %}</a><br/> 
{% endif %}

{% if date_range == 'this_month' %}
 <span style="font-size:15px">{% trans "This Month" %}</span><br/>
 {% else %}
 <a href="?date_range=this_month">{% trans "This Month" %}</a><br/> 
{% endif %}

	<a href="javascript:alert('Not implemented yet!');">{% trans "This Season" %}</a><br/>  

{% if date_range == 'this_year' %}
 <span style="font-size:15px">{% trans "This Year" %}</span><br/>
 {% else %}
<a href="?date_range=this_year">{% trans "This Year" %}</a><br/>  
{% endif %}


	<a href="javascript:alert('Not implemented yet!');">{% trans "Pick a Range" %}</a><br/>  
    
    {% comment %}
{% trans "Day" %}: {{day}}<br/> 
{% trans "month" %}: {{month}}<br/> 
{% trans "year" %}: {{year}}<br/> 
{% endcomment %}

{% if bookname == 'snippetbook' %}    
            <h4>{% trans "With attachment" %}</h4>  
       {% if with_attachment in all_words %}
             <span style="font-size:15px">{% trans "All" %}</span><br/>
        {% else %}
            <a href="?with_attachment=All">{% trans "All" %}</a><br/>   
        {% endif %}   

        {% if with_attachment in true_words %}
             <span style="font-size:15px">{% trans "Yes" %}</span><br/>
        {% else %}
            <a href="?with_attachment=True">{% trans "Yes" %}</a><br/>
        {% endif %}  
{% endif %}                 
      
       
        {% comment %}   
{% block linkage_filter %}
{% endblock %}
{% endcomment %}

</div>





{% block profile_head %}

{% include "include/profile_head.html" %}

{% endblock %}

{% block special_side_menu %}
{% endblock %}

{% comment %}
<!--
<div class="module"> 
        <h2>{% trans "Sorting" %}</h2>  

{% if sort == 'vote' %}
 <span style="font-size:15px">{% trans "By Importance" %}</span><br/>
 {% else %}
 <a href="?sort=vote">{% trans "By Importance" %}</a><br/> 	
{% endif %}

{% if sort == 'init_date' %}
 <span style="font-size:15px">{% trans "By Creation Date" %}</span><br/>
 {% else %}
<a href="?sort=init_date">{% trans "By Creation Date" %}</a><br/>
{% endif %}

{% if sort == 'last_modi_date' %}
 <span style="font-size:15px">{% trans "By Last Modification Date" %}</span><br/>
 {% else %}
<a href="?sort=last_modi_date">{% trans "By Last Modification Date" %}</a><br/>
{% endif %}

{% if sort == 'title' %}
 <span style="font-size:15px">{% trans "By Title" %}</span><br/>
 {% else %}
<a href="?sort=title">{% trans "By Title" %}</a><br/> 	
{% endif %}

{% if sort == 'desc' %}
 <span style="font-size:15px">{% trans "By Desc" %}</span><br/>
 {% else %}
<a href="?sort=desc">{% trans "By Desc" %}</a><br/> 	
{% endif %}
    
 <h4>{% trans "Order Type" %}</h4> 
{% if order_type == 'desc' %}
 <span style="font-size:15px">{% trans "Descend" %}</span><br/>
 {% else %}
<a href="?order_type=desc">{% trans "Descend" %}</a><br/>   	
{% endif %}
{% if order_type == 'asc' %}
 <span style="font-size:15px">{% trans "Ascend" %}</span><br/>
 {% else %}
 <a href="?order_type=asc">{% trans "Ascend" %}</a><br/>    	
{% endif %}
             
      
            
</div> 


<div class="module"> 
        <h2>{% trans "Archive" %}</h2> 
	
</div> 

{% if user.username == profile_username %}
<div class="module"> 
        <h2>{% trans "Managing" %}</h2>  
       <a href="/{{profile_username}}/settings/tags/">{% trans "Manage Tags" %}</a><br/>           
       <a href="/{{profile_username}}/{{bookname}}/settings/folders/">{% trans "Manage Folders" %}</a><br/>             
</div>

{% block import_menu %}
{% endblock %}

{% endif %}


-->

<!--
<div class="module"> 
        <h2>{% trans "My Learning Groups" %}</h2>  
         <a href="javascript:alert('Not implemented yet!');">{% trans "Create a Learning Group" %}</a><br/>             
</div>
-->
{% endcomment%}

</div> 
{% comment %}
{% include "include/debug_query.html" %}
{% endcomment %}



<div id='main'>


{% block header %}
<div id="header" class="noPrint">
    <div id="branding">
        <h1 id="site-name">{% block header_title %}{% blocktrans %}Personal notes of {{profile_username}}{% endblocktrans %}{% endblock %}</h1>
    </div>

    
<div class="book_tabs old">
        <span class="book_tabs_item {% if bookname == 'snippetbook' %}current{% endif %}" onclick="window.location.replace('{{ book_uri_prefix }}/snippetbook/notes/')">{% trans "Snippets" %}</span>
        <span class="book_tabs_item {% if bookname == 'bookmarkbook' %}current{% endif %}" onclick="window.location.replace('{{ book_uri_prefix }}/bookmarkbook/notes/')">{% trans "Bookmarks" %}</span>
        <span class="book_tabs_item {% if bookname == 'scrapbook' %}current{% endif %}" onclick="window.location.replace('{{ book_uri_prefix }}/scrapbook/notes/')">{% trans "Scraps" %}</span>

        <span class="book_tabs_item advanced {% if bookname == 'framebook' %}current{% endif %}" onclick="window.location.replace('{{ book_uri_prefix }}/framebook/notes/')">{% trans "Frames" %}</span>
        <span class="book_tabs_item advanced {% if bookname == 'notebook' %}current{% endif %}" onclick="window.location.replace('{{ book_uri_prefix }}/notebook/notes/')">{% trans "All" %}</a></span> 
    </div>
</div>
{% endblock %}



{% block content %}




{% endblock %}
</div>


</div>





<div id="footer" class="noPrint">
{% include "include/footer.html" %}
</div>


</body> 
</html> 